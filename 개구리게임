<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>개구리 무한 점프 게임</title>
    <style>
        body { margin: 0; padding: 0; background: #333; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Arial', sans-serif; }
        canvas { background: linear-gradient(to bottom, #87CEEB, #E0F6FF); border: 4px solid #fff; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        #ui { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); color: white; text-align: center; text-shadow: 1px 1px 2px black; pointer-events: none; }
    </style>
</head>
<body>

    <div id="ui">
        <h2 id="score">점수: 0</h2>
        <h3 id="lives">목숨: ❤️❤️❤️</h3>
        <h1 id="gameOverMsg" style="display:none; color: red; font-size: 40px;">GAME OVER<br><span style="font-size:20px; color:white;">(F5를 눌러 재시작)</span></h1>
    </div>
    <canvas id="gameCanvas" width="400" height="600"></canvas>

<script>
    // --- 1. 게임 기본 설정 ---
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    
    // 게임 상태 변수들
    let score = 0;
    let lives = 3;
    let isGameOver = false;
    let gravity = 0.4;
    
    // 키보드 입력 상태
    const keys = { right: false, left: false };

    // --- 2. 게임 오브젝트 (주인공, 발판, 새, 아이템) ---
    
    // 개구리 (주인공)
    const frog = {
        x: 180, y: 500, width: 30, height: 30,
        dx: 0, dy: 0, speed: 5, jumpPower: -10,
        color: "#32CD32", // 초록색
        isInvincible: false // 무적 상태 (새 충돌 시 깜빡임)
    };

    // 발판 (구름) 배열
    let platforms = [];
    const platformWidth = 60;
    const platformHeight = 15;

    // 새 (장애물) 배열
    let birds = [];

    // 부스트 아이템
    let boostItem = null; // 화면에 하나만 존재하도록

    // --- 3. 초기화 함수 ---
    function init() {
        // 시작 발판 생성
        platforms.push({ x: 170, y: 580 }); 
        for (let i = 0; i < 6; i++) {
            spawnPlatform(500 - i * 100);
        }
    }

    function spawnPlatform(y) {
        const x = Math.random() * (canvas.width - platformWidth);
        platforms.push({ x: x, y: y });
        
        // 20% 확률로 새(장애물) 생성 (발판보다 조금 위에)
        if (Math.random() < 0.2 && score > 100) { // 점수 100점 넘으면 나오기 시작
            spawnBird(y - 50);
        }

        // 5% 확률로 부스트 아이템 생성
        if (Math.random() < 0.05 && !boostItem) {
            boostItem = { x: x + 15, y: y - 40, width: 20, height: 20 };
        }
    }

    function spawnBird(y) {
        let startX = Math.random() < 0.5 ? -30 : canvas.width + 30;
        let speed = startX < 0 ? 2 : -2; // 왼쪽에서 오면 +, 오른쪽에서 오면 -
        birds.push({ x: startX, y: y, width: 30, height: 20, dx: speed });
    }

    // --- 4. 게임 루프 (핵심 로직) ---
    function update() {
        if (isGameOver) return;

        // --- 개구리 이동 ---
        if (keys.left) frog.dx = -frog.speed;
        else if (keys.right) frog.dx = frog.speed;
        else frog.dx = 0;

        frog.x += frog.dx;
        frog.dy += gravity;
        frog.y += frog.dy;

        // 화면 좌우 벽 충돌 방지
        if (frog.x < 0) frog.x = 0;
        if (frog.x + frog.width > canvas.width) frog.x = canvas.width - frog.width;

        // --- 발판 충돌 (내려올 때만 밟을 수 있음) ---
        if (frog.dy > 0) { 
            platforms.forEach(p => {
                if (
                    frog.x < p.x + platformWidth &&
                    frog.x + frog.width > p.x &&
                    frog.y + frog.height > p.y &&
                    frog.y + frog.height < p.y + platformHeight + 5 // 발판 살짝 위에서 닿았을 때
                ) {
                    frog.dy = frog.jumpPower; // 점프!
                }
            });
        }

        // --- 화면 스크롤 (개구리가 높이 올라가면) ---
        if (frog.y < 250) {
            let offset = 250 - frog.y;
            frog.y = 250; // 개구리 고정
            
            // 모든 물체를 아래로 내림
            platforms.forEach(p => p.y += offset);
            birds.forEach(b => b.y += offset);
            if (boostItem) boostItem.y += offset;

            score += Math.floor(offset); // 점수 증가
            document.getElementById("score").innerText = "점수: " + score;

            // 맨 아래로 사라진 발판 제거 및 새 발판 생성
            platforms = platforms.filter(p => p.y < canvas.height);
            if (platforms.length < 7) {
                spawnPlatform(platforms[platforms.length - 1].y - 90 - Math.random() * 40);
            }
        }

        // --- 새(장애물) 이동 및 충돌 ---
        birds.forEach((b, index) => {
            b.x += b.dx;
            // 충돌 체크 (단순 사각형 충돌)
            if (!frog.isInvincible && 
                frog.x < b.x + b.width && frog.x + frog.width > b.x &&
                frog.y < b.y + b.height && frog.y + frog.height > b.y) {
                
                loseLife();
            }
        });
        // 화면 밖으로 나간 새 제거
        birds = birds.filter(b => b.x > -100 && b.x < canvas.width + 100);

        // --- 부스트 아이템 충돌 ---
        if (boostItem) {
            if (frog.x < boostItem.x + boostItem.width &&
                frog.x + frog.width > boostItem.x &&
                frog.y < boostItem.y + boostItem.height &&
                frog.y + frog.height > boostItem.y) {
                
                // 부스트 효과!
                frog.dy = -25; // 슈퍼 점프
                boostItem = null; // 아이템 사라짐
            }
            if (boostItem && boostItem.y > canvas.height) boostItem = null; // 화면 밖 제거
        }

        // --- 게임 오버 체크 (추락) ---
        if (frog.y > canvas.height) {
            setGameOver();
        }
    }

    function loseLife() {
        lives--;
        updateLivesUI();
        
        if (lives <= 0) {
            setGameOver();
        } else {
            // 무적 상태 부여 (2초)
            frog.isInvincible = true;
            frog.color = "rgba(50, 205, 50, 0.5)"; // 반투명
            setTimeout(() => {
                frog.isInvincible = false;
                frog.color = "#32CD32";
            }, 2000);
        }
    }

    function updateLivesUI() {
        let hearts = "";
        for(let i=0; i<lives; i++) hearts += "❤️";
        document.getElementById("lives").innerText = "목숨: " + hearts;
    }

    function setGameOver() {
        isGameOver = true;
        document.getElementById("gameOverMsg").style.display = "block";
    }

    // --- 5. 그리기 함수 (렌더링) ---
    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 발판 그리기 (구름 모양 대신 둥근 사각형)
        ctx.fillStyle = "white";
        platforms.forEach(p => {
            ctx.beginPath();
            ctx.roundRect(p.x, p.y, platformWidth, platformHeight, 10);
            ctx.fill();
        });

        // 부스트 아이템 그리기 (노란색)
        if (boostItem) {
            ctx.fillStyle = "gold";
            ctx.fillRect(boostItem.x, boostItem.y, boostItem.width, boostItem.height);
            ctx.strokeStyle = "orange";
            ctx.strokeRect(boostItem.x, boostItem.y, boostItem.width, boostItem.height);
        }

        // 새 그리기 (빨간색)
        ctx.fillStyle = "red";
        birds.forEach(b => {
            ctx.beginPath();
            // 간단한 새 모양 (세모)
            ctx.moveTo(b.x, b.y + b.height/2);
            ctx.lineTo(b.x + b.width/2, b.y);
            ctx.lineTo(b.x + b.width, b.y + b.height/2);
            ctx.lineTo(b.x + b.width/2, b.y + b.height);
            ctx.fill();
        });

        // 개구리 그리기
        ctx.fillStyle = frog.color;
        ctx.fillRect(frog.x, frog.y, frog.width, frog.height);
        // 개구리 눈
        ctx.fillStyle = "white";
        ctx.beginPath(); ctx.arc(frog.x + 8, frog.y + 5, 5, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(frog.x + 22, frog.y + 5, 5, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "black";
        ctx.beginPath(); ctx.arc(frog.x + 8, frog.y + 5, 2, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(frog.x + 22, frog.y + 5, 2, 0, Math.PI*2); ctx.fill();

        requestAnimationFrame(draw);
        update(); // 그리기와 로직 업데이트 반복
    }

    // --- 이벤트 리스너 ---
    window.addEventListener("keydown", e => {
        if (e.code === "ArrowRight") keys.right = true;
        if (e.code === "ArrowLeft") keys.left = true;
    });
    window.addEventListener("keyup", e => {
        if (e.code === "ArrowRight") keys.right = false;
        if (e.code === "ArrowLeft") keys.left = false;
    });

    // 게임 시작
    init();
    draw();

</script>
</body>
</html>
